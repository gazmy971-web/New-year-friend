<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Staff Raffle Spinner</title>
<style>
body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; text-align:center; background:#f0f2f5; color: #333; padding-bottom: 50px;}
h2 { color: #2c3e50; margin-bottom: 10px; }
button { padding:12px 25px; font-size:16px; margin:10px; border:none; border-radius:50px;
background:#007bff; color:white; cursor:pointer; transition: background 0.3s; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
button:hover { background:#0056b3; }
button:disabled { background: #ccc; cursor: not-allowed; }
.admin-btn { background-color: #6c757d; margin-top: 30px;}
.admin-btn:hover { background-color: #5a6268; }

#result { font-size:24px; margin-top:20px; font-weight:bold; color: #28a745; min-height: 40px; }
select { padding: 10px 15px; font-size: 16px; border-radius: 8px; border: 1px solid #ccc; margin-bottom: 20px; width: 80%; max-width: 300px;}
table { margin:auto; padding:10px; border-collapse:collapse; font-size:16px; display:none; margin-top: 30px; background: white; box-shadow: 0 2px 10px rgba(0,0,0,0.1); border-radius: 8px; overflow: hidden; width: 90%; max-width: 600px; }
th, td { border:1px solid #ddd; padding:12px; text-align: left; }
th { background-color: #f8f9fa; font-weight: bold; }
tr:nth-child(even) { background-color: #f9f9f9; }

/* Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ù‚ÙÙ„ */
#lockedMessage { display: none; color: #dc3545; font-weight: bold; font-size: 18px; margin: 20px; padding: 20px; border: 2px dashed #dc3545; border-radius: 10px; background: #fff; }
</style>
</head>
<body>

<h2>ğŸ¡ Staff Raffle Spinner</h2>

<div id="gameArea">
    <p>Ø§Ø®ØªØ§Ø± Ø§Ø³Ù…Ùƒ ÙˆØ§Ø¶ØºØ· Spin (Ù…Ø³Ù…ÙˆØ­ Ù„Ùƒ Ù…Ø±Ø© ÙˆØ§Ø­Ø¯Ø© ÙÙ‚Ø·)</p>
    
    <select id="selector">
        <option value="" disabled selected>-- Ø§Ø®ØªØ± Ø§Ø³Ù…Ùƒ --</option>
    </select>
    
    <br>
    <canvas id="wheel" width="450" height="450" style="max-width: 100%; height: auto;"></canvas>
    <br>
    
    <button onclick="spin()" id="spinBtn">SPIN ğŸ²</button>
    <div id="result"></div>
</div>

<div id="lockedMessage">
    â›” Ù„Ù‚Ø¯ Ù‚Ù…Øª Ø¨Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ© Ø¨Ø§Ù„ÙØ¹Ù„! <br>
    <span id="savedChoice" style="color: #28a745; display:block; margin-top:10px;"></span>
</div>

<hr style="margin: 40px 0; border: 0; border-top: 1px solid #ddd;">

<button onclick="revealResults()" class="admin-btn">Show Results (Admin Only ğŸ”’)</button>

<div id="adminControls" style="display:none; margin-top: 10px;">
    <button onclick="resetMyStatus()" style="background: #dc3545; font-size: 12px; padding: 5px 10px;">Reset My Status (For Testing)</button>
</div>

<table id="resultsTable">
  <thead>
    <tr><th>Ø§Ù„Ø´Ø®Øµ (Selector)</th><th>Ø§Ù„Ù‡Ø¯ÙŠØ© (Selected)</th></tr>
  </thead>
  <tbody></tbody>
</table>

<script>
// --- Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø£Ø³Ù…Ø§Ø¡ ---
let originalNames = ["Edress","Jijo","Ajay","Abualsoud","Rinu","Abdelaziz","Khalid","Lija","Somi","Karthik","Cleo","Wala","Wael","Hashem","Rini","Sowmya","Margeret","Sreepa","Anju tom","Ruksana","Ambia","Jesmol","Hossam","George","Shaza","Asma","Fatima"];

let remainingTargets = [...originalNames];
let results = {};
let namesOnWheel = [];
let arc = 0;
let startAngle = 0;
let spinning = false;

const selector = document.getElementById("selector");
const gameArea = document.getElementById("gameArea");
const lockedMessage = document.getElementById("lockedMessage");
const savedChoiceSpan = document.getElementById("savedChoice");

// --- Ø§Ù„ØªØ­Ù‚Ù‚ Ù‡Ù„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù„Ø¹Ø¨ Ù…Ù† Ù‚Ø¨Ù„ØŸ ---
window.onload = function() {
    // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø°Ø§ÙƒØ±Ø© Ø§Ù„Ù…Ø­Ù„ÙŠØ© Ù„Ù„Ù…ØªØµÙØ­
    let savedPerson = localStorage.getItem('raffle_person');
    let savedSelected = localStorage.getItem('raffle_selected');

    if (savedPerson && savedSelected) {
        // Ø¥Ø°Ø§ Ù„Ø¹Ø¨ Ù…Ù† Ù‚Ø¨Ù„ØŒ Ù†Ø®ÙÙŠ Ø§Ù„Ù„Ø¹Ø¨Ø© ÙˆÙ†Ø¸Ù‡Ø± Ø§Ù„Ø±Ø³Ø§Ù„Ø©
        lockGame(savedPerson, savedSelected);
    } else {
        // Ø¥Ø°Ø§ Ù„Ù… ÙŠÙ„Ø¹Ø¨ØŒ Ù†Ø¬Ù‡Ø² Ø§Ù„Ù„Ø¹Ø¨Ø©
        fillDropdown();
        prepareWheel(originalNames);
    }
};

function fillDropdown() {
    selector.innerHTML = '<option value="" disabled selected>-- Ø§Ø®ØªØ± Ø§Ø³Ù…Ùƒ --</option>';
    originalNames.sort().forEach(n => {
        const opt = document.createElement("option");
        opt.value = opt.textContent = n;
        selector.appendChild(opt);
    });
}

const wheel = document.getElementById("wheel");
const ctx = wheel.getContext("2d");

function drawWheel() {
    if (namesOnWheel.length === 0) return;
    arc = (2 * Math.PI) / namesOnWheel.length;
    
    for (let i = 0; i < namesOnWheel.length; i++) {
        let angle = startAngle + i * arc;
        ctx.beginPath();
        ctx.fillStyle = i % 2 === 0 ? "#FFD700" : "#FFC107";
        ctx.moveTo(225, 225);
        ctx.arc(225, 225, 225, angle, angle + arc);
        ctx.fill();
        ctx.save();
        ctx.fillStyle = "black";
        ctx.translate(225, 225);
        ctx.rotate(angle + arc / 2);
        ctx.textAlign = "right";
        ctx.font = "bold 14px Arial";
        ctx.fillText(namesOnWheel[i], 200, 5);
        ctx.restore();
    }
}

function prepareWheel(list) {
    namesOnWheel = [...list];
    ctx.clearRect(0,0,450,450);
    drawWheel();
}

function spin() {
    if (spinning) return;
    
    let person = selector.value;
    if (!person) {
        alert("Ù…Ù† ÙØ¶Ù„Ùƒ Ø§Ø®ØªØ± Ø§Ø³Ù…Ùƒ Ø£ÙˆÙ„Ø§Ù‹!");
        return;
    }
    
    let availableOptions = remainingTargets.filter(n => n !== person);
    if (availableOptions.length === 0) {
        alert("Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø£Ø³Ù…Ø§Ø¡ ÙƒØ§ÙÙŠØ©!");
        return;
    }
    
    prepareWheel(availableOptions);
    
    spinning = true;
    document.getElementById("spinBtn").disabled = true;

    let spinAngle = Math.random() * 3000 + 3000; 
    let duration = 3000;
    let start = null;
    
    function animate(timestamp) {
        if (!start) start = timestamp;
        let progress = timestamp - start;
        
        startAngle += (spinAngle * (1 - progress/duration) / 100); 

        ctx.clearRect(0, 0, 450, 450);
        drawWheel();
        
        if (progress < duration) {
            requestAnimationFrame(animate);
        } else {
            spinning = false;
            finalizePick(person, availableOptions);
        }
    }
    requestAnimationFrame(animate);
}

function finalizePick(person, list) {
    let index = Math.floor((list.length - (startAngle % (2 * Math.PI)) / arc) % list.length);
    if (index < 0) index += list.length;
    let selected = list[index];
    
    // 1. Ø¹Ø±Ø¶ Ø§Ù„Ù†ØªÙŠØ¬Ø©
    document.getElementById("result").innerText = "ğŸ‰ " + selected + " ğŸ‰";
    
    // 2. Ø­ÙØ¸ ÙÙŠ Ø§Ù„Ø°Ø§ÙƒØ±Ø© (Ù„Ù…Ù†Ø¹ Ø§Ù„Ù„Ø¹Ø¨ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰)
    localStorage.setItem('raffle_person', person);
    localStorage.setItem('raffle_selected', selected);
    
    // 3. ØªØ£Ø®ÙŠØ± Ø¨Ø³ÙŠØ· Ø«Ù… Ù‚ÙÙ„ Ø§Ù„Ø´Ø§Ø´Ø©
    setTimeout(() => {
        alert("Ù…Ø¨Ø±ÙˆÙƒ! Ù„Ù‚Ø¯ Ø§Ø®ØªØ±Øª: " + selected);
        lockGame(person, selected);
    }, 1000);
}

function lockGame(person, selected) {
    gameArea.style.display = 'none'; // Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø¹Ø¬Ù„Ø©
    lockedMessage.style.display = 'block'; // Ø¥Ø¸Ù‡Ø§Ø± Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ù‚ÙÙ„
    savedChoiceSpan.innerText = "Ø£Ù†Øª (" + person + ") Ø§Ø®ØªØ±Øª: " + selected;
}

// --- ÙˆØ¸Ø§Ø¦Ù Ø§Ù„Ø£Ø¯Ù…Ù† ---

function updateResultsTable(){
  const table = document.getElementById('resultsTable');
  const tbody = table.querySelector('tbody');
  tbody.innerHTML = ""; 
  
  // Ø¨Ù…Ø§ Ø£Ù†Ù†Ø§ Ù„Ø§ Ù†Ù…Ù„Ùƒ Ù‚Ø§Ø¹Ø¯Ø© Ø¨ÙŠØ§Ù†Ø§ØªØŒ Ø³Ù†Ø¹Ø±Ø¶ ÙÙ‚Ø· Ù†ØªÙŠØ¬Ø© Ø§Ù„Ø´Ø®Øµ Ø§Ù„Ø­Ø§Ù„ÙŠ Ø¥Ø°Ø§ ÙƒØ§Ù† Ù‡Ùˆ Ù…Ù† ÙØªØ­ Ø§Ù„ØµÙØ­Ø©
  // Ø£Ùˆ Ø¥Ø°Ø§ ÙƒÙ†Øª ØªØ±ÙŠØ¯ Ø¹Ø±Ø¶ Ø¨ÙŠØ§Ù†Ø§Øª ØªØ¬Ø±ÙŠØ¨ÙŠØ©.
  // Ù…Ù„Ø§Ø­Ø¸Ø©: Ù„Ø¬Ù…Ø¹ Ù†ØªØ§Ø¦Ø¬ *Ø§Ù„Ø¬Ù…ÙŠØ¹* ØªØ­ØªØ§Ø¬ Ù‚Ø§Ø¹Ø¯Ø© Ø¨ÙŠØ§Ù†Ø§Øª (Google Sheets Ø£Ùˆ Firebase).
  // Ù‡Ø°Ø§ Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø³ÙŠØ¹Ø±Ø¶ ÙÙ‚Ø· Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø®Ø²Ù†Ø© Ù…Ø­Ù„ÙŠØ§Ù‹ Ù„Ù‡Ø°Ø§ Ø§Ù„Ø¬Ù‡Ø§Ø².
  
  let p = localStorage.getItem('raffle_person');
  let s = localStorage.getItem('raffle_selected');
  
  if (p && s) {
      let row = tbody.insertRow();
      let cell1 = row.insertCell(0);
      let cell2 = row.insertCell(1);
      cell1.innerText = p;
      cell2.innerText = s;
  } else {
      let row = tbody.insertRow();
      let cell1 = row.insertCell(0);
      cell1.colSpan = 2;
      cell1.innerText = "Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬ Ù…Ø³Ø¬Ù„Ø© Ø¹Ù„Ù‰ Ù‡Ø°Ø§ Ø§Ù„Ø¬Ù‡Ø§Ø² Ø¨Ø¹Ø¯.";
      cell1.style.textAlign = "center";
  }
}

function revealResults() {
  const table = document.getElementById('resultsTable');
  const adminControls = document.getElementById('adminControls');

  if (table.style.display === 'table') {
      table.style.display = 'none';
      adminControls.style.display = 'none';
      return;
  }

  let password = prompt("ğŸ” Enter Admin Password:");
  
  if (password === "9090") {
      table.style.display = 'table';
      adminControls.style.display = 'block';
      updateResultsTable();
  } else if (password !== null) {
      alert("âŒ Wrong Password!");
  }
}

function resetMyStatus() {
    if(confirm("Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ØŸ Ù‡Ø°Ø§ Ø³ÙŠØ³Ù…Ø­ Ù„Ùƒ Ø¨Ø§Ù„Ù„Ø¹Ø¨ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰ Ø¹Ù„Ù‰ Ù‡Ø°Ø§ Ø§Ù„Ø¬Ù‡Ø§Ø².")) {
        localStorage.clear();
        location.reload();
    }
}
</script>

</body>
</html>
