<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Staff Raffle Spinner</title>
<style>
body { font-family: Arial, sans-serif; text-align:center; background:#f7f7f7; }
button { padding:12px 25px; font-size:18px; margin:15px; border:none; border-radius:10px;
background:#007bff; color:white; cursor:pointer; }
#result { font-size:22px; margin-top:20px; font-weight:bold; }
table { margin:auto; padding:10px; border-collapse:collapse; font-size:18px; display:none; margin-top: 20px;}
table, th, td { border:1px solid black; padding:5px; }
</style>
</head>
<body>
<h2>ðŸŽ¡ Staff Raffle Spinner</h2>
<p>Select a name and press SPIN</p>
<select id="selector" style="padding:10px; font-size:16px;">
</select>
<br>
<canvas id="wheel" width="450" height="450"></canvas>
<br>
<button onclick="spin()">SPIN</button>
<button onclick="revealResults()">Show Results (Admin)</button>
<div id="result"></div>
<table id="resultsTable">
  <thead>
    <tr><th>Selector</th><th>Selected</th></tr>
  </thead>
  <tbody></tbody>
</table>

<script>
let originalNames = ["Edress","Jijo","Ajay","Abualsoud","Rinu","Abdelaziz","Khalid","Lija","Somi","Karthik","Cleo","Wala","Wael","Hashem","Rini","Sowmya","Margeret","Sreepa","Anju tom","Ruksana","Ambia","Jesmol","Hossam","George","Shaza","Asma","Fatima"];
let remaining = [...originalNames];
let results = {};
let names = [];
let arc = 0;
let startAngle = 0;
let spinning = false;

const selector = document.getElementById("selector");
originalNames.forEach(n => {
    const opt = document.createElement("option");
    opt.value = opt.textContent = n;
    selector.appendChild(opt);
});

const wheel = document.getElementById("wheel");
const ctx = wheel.getContext("2d");

function drawWheel() {
    if (names.length === 0) return;
    arc = (2 * Math.PI) / names.length; // Recalculate arc based on current names
    
    for (let i = 0; i < names.length; i++) {
        let angle = startAngle + i * arc;
        ctx.beginPath();
        ctx.fillStyle = i % 2 === 0 ? "#ffe066" : "#ffc107";
        ctx.moveTo(225, 225);
        ctx.arc(225, 225, 225, angle, angle + arc);
        ctx.fill();
        ctx.save();
        ctx.fillStyle = "black";
        ctx.translate(225, 225);
        ctx.rotate(angle + arc / 2);
        ctx.textAlign = "right";
        ctx.font = "16px Arial";
        ctx.fillText(names[i], 200, 5);
        ctx.restore();
    }
}

function prepareWheel(list) {
    names = [...list];
    ctx.clearRect(0,0,450,450);
    drawWheel();
}

prepareWheel(originalNames);

function spin() {
    if (spinning) return;
    let person = selector.value;
    if (!remaining.includes(person)) {
        alert(person + " already selected!");
        return;
    }
    
    // Filter out the person spinning so they don't pick themselves
    let options = remaining.filter(n => n !== person);
    
    if (options.length === 0) {
        alert("No more names left!");
        return;
    }
    
    prepareWheel(options);
    spinning = true;
    let spinAngle = Math.random() * 3000 + 3000;
    let duration = 3000;
    let start = null;
    
    function animate(timestamp) {
        if (!start) start = timestamp;
        let progress = timestamp - start;
        // Ease out logic could be added here, currently linear speed reduction
        // Simplified spin logic from your code:
        let easeOut = 1 - Math.pow(1 - progress/duration, 3); // simple easing
        startAngle += (spinAngle * (1 - progress/duration) / 100); // Decelerate

        ctx.clearRect(0, 0, 450, 450);
        drawWheel();
        
        if (progress < duration) {
            requestAnimationFrame(animate);
        } else {
            spinning = false;
            pickWinner(person, options);
        }
    }
    requestAnimationFrame(animate);
}

function pickWinner(person, list) {
    // Calculate the index based on the final angle
    let index = Math.floor((list.length - (startAngle % (2 * Math.PI)) / arc) % list.length);
    // Ensure positive index
    if (index < 0) index += list.length;
    
    let selected = list[index];
    
    if(!selected) {
         // Fallback if math is slightly off due to float precision
         selected = list[0]; 
    }

    results[person] = selected;
    // Remove the selected person from the pool for future spins
    remaining = remaining.filter(n => n !== selected);
    
    document.getElementById("result").innerText = person + " selected â†’ " + selected;
    
    // Refresh the wheel with original names or remaining names? 
    // Usually we show original list or just remove the picked one. 
    // Let's reset to full list visually or keep current? 
    // Your code seemed to reset. Let's show remaining to avoid confusion.
    prepareWheel(originalNames); 
    
    updateResultsTable();
}

function updateResultsTable(){
  const table = document.getElementById('resultsTable');
  const tbody = table.querySelector('tbody');
  tbody.innerHTML = ""; // Clear existing
  
  for (let [p, s] of Object.entries(results)) {
      let row = tbody.insertRow();
      let cell1 = row.insertCell(0);
      let cell2 = row.insertCell(1);
      cell1.innerText = p;
      cell2.innerText = s;
  }
}

function revealResults() {
  const table = document.getElementById('resultsTable');
  table.style.display = 'table';
  updateResultsTable();
}
</script>
</body>
</html>
